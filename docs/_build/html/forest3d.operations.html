<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" data-content_root="./" lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" media="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="Docutils 0.18.1: http://docutils.sourceforge.net/" name="generator"/>
<title>forest3d.operations | Forest3D</title>
<meta content="forest3d.operations | Forest3D" property="og:title"/>
<meta content="forest3d.operations | Forest3D" name="twitter:title"/>
<link href="_static/pygments.css?v=8d216cef" rel="stylesheet" type="text/css"/>
<link href="_static/theme.css?v=8958d2b4" rel="stylesheet" type="text/css"/>
<link href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" rel="stylesheet" type="text/css"/>
<link href="_static/autoclass.css?v=497c207f" rel="stylesheet" type="text/css"/>
<link href="_static/awesome-sphinx-design.css?v=a54cf077" rel="stylesheet" type="text/css"/>
<link href="https://josafatburmeister.github.io/forest3d/forest3d.operations.html" rel="canonical"/>
<link href="search.html" rel="search" title="Search"/>
<link href="forest3d.visualization.html" rel="next" title="forest3d.visualization"/>
<link href="forest3d.instance_segmentation.html" rel="prev" title="forest3d.instance_segmentation"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a><header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="index.html"><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">Forest3D</span>
</a><nav class="flex items-center space-x-6 text-sm font-medium">
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="/forest3d/index.html">Docs</a>
</nav></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none"><form @keydown.k.window.meta="$refs.search.focus()" action="search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">⌘</span>
    K
  </kbd>
</form>
</div>
<nav class="flex items-center space-x-1">
<a href="https://github.com/josafatburmeister/forest3d" rel="noopener nofollow" title="Visit repository on GitHub">
<div class="inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md disabled:opacity-50 disabled:pointer-events-none hover:bg-accent hover:text-accent-foreground h-9 w-9">
<svg fill="currentColor" height="26px" style="margin-top:-2px;display:inline" viewbox="0 0 45 44" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M22.477.927C10.485.927.76 10.65.76 22.647c0 9.596 6.223 17.736 14.853 20.608 1.087.2 1.483-.47 1.483-1.047 0-.516-.019-1.881-.03-3.693-6.04 1.312-7.315-2.912-7.315-2.912-.988-2.51-2.412-3.178-2.412-3.178-1.972-1.346.149-1.32.149-1.32 2.18.154 3.327 2.24 3.327 2.24 1.937 3.318 5.084 2.36 6.321 1.803.197-1.403.759-2.36 1.379-2.903-4.823-.548-9.894-2.412-9.894-10.734 0-2.37.847-4.31 2.236-5.828-.224-.55-.969-2.759.214-5.748 0 0 1.822-.584 5.972 2.226 1.732-.482 3.59-.722 5.437-.732 1.845.01 3.703.25 5.437.732 4.147-2.81 5.967-2.226 5.967-2.226 1.185 2.99.44 5.198.217 5.748 1.392 1.517 2.232 3.457 2.232 5.828 0 8.344-5.078 10.18-9.916 10.717.779.67 1.474 1.996 1.474 4.021 0 2.904-.027 5.247-.027 5.96 0 .58.392 1.256 1.493 1.044C37.981 40.375 44.2 32.24 44.2 22.647c0-11.996-9.726-21.72-21.722-21.72" fill="currentColor" fill-rule="evenodd"></path></svg>
</div>
</a>
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" aria-label="Color theme switcher" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="index.html"><span class="font-bold text-clip whitespace-nowrap">Forest3D</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="flex md:hidden flex-col font-medium mt-4">
<a href="/forest3d/index.html">Docs</a>
</nav><nav class="table w-full min-w-full my-6 lg:my-8">
<ul class="current">
<li class="toctree-l1 current" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="forest3d.html">forest3d<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul class="current" x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="forest3d.config.html">forest3d.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="forest3d.evaluation.html">forest3d.evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="forest3d.instance_segmentation.html">forest3d.instance_segmentation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">forest3d.operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="forest3d.visualization.html">forest3d.visualization</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="index.html">
<span class="hidden md:inline">Forest3D</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap" href="forest3d.html">forest3d</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">forest3d.operations</span>
</nav>
<div id="content" role="main">
<section id="module-forest3d.operations">
<span id="forest3d-operations"></span><h1>forest3d.operations<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#module-forest3d.operations"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<p>Algorithms for tree instance segmentation.</p>
<dl class="py function">
<dt class="sig sig-object py" id="forest3d.operations.knn_search">
<span class="sig-prename descclassname"><span class="pre">forest3d.operations.</span></span><span class="sig-name descname"><span class="pre">knn_search</span></span><span class="sig-paren">(</span>
<dl>
<dd><em class="sig-param"><span class="n"><span class="pre">coords_support_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">coords_query_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">batch_indices_support_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">batch_indices_query_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">point_cloud_sizes_support_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">point_cloud_sizes_query_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">return_sorted</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>,</dd>
</dl>
<span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/forest3d/operations/_knn_search.html#knn_search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#forest3d.operations.knn_search" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#forest3d.operations.knn_search'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></dt>
<dd><p>Computes the indices of <code class="docutils literal notranslate"><span class="pre">k</span></code> nearest neighbors. Decides between different implementations:</p>
<ul class="simple">
<li><p><strong>Implementation from PyTorch3D:</strong> This implementation is always used if PyTorch3D is installed because its more efficient in terms of runtime and memory consumption than the other available implementations.</p></li>
<li><p><strong>Implementation from torch-cluster:</strong> This implementation is used when PyTorch3D is not installed. It is similar to the PyTorch3D implementation but is slighlty slower.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coords_support_points</strong> – Coordinates of the support points to be searched for neighbors.</p></li>
<li><p><strong>coords_query_points</strong> – Coordinates of the query points.</p></li>
<li><p><strong>batch_indices_support_points</strong> – Indices indicating to which point cloud in the batch each support point belongs.</p></li>
<li><p><strong>batch_indices_query_points</strong> – Indices indicating to which point cloud in the batch each query point belongs.</p></li>
<li><p><strong>point_cloud_sizes_support_points</strong> – Number of points in each point cloud in the batch of support points.</p></li>
<li><p><strong>point_cloud_sizes_query_points</strong> – Number of points in each point cloud in the batch of query points.</p></li>
<li><p><strong>k</strong> – The number of nearest neighbors to search.</p></li>
<li><p><strong>return_sorted</strong> – Whether the returned neighbors should be sorted by their distance to the query point. Defaults to
<code class="docutils literal notranslate"><span class="pre">True</span></code>. Setting it to <code class="docutils literal notranslate"><span class="pre">False</span></code> can improve performance for some implementations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of two tensors. The first tensor contains the indices of the neighbors of each query point. The
second tensor contains the distances between the neighbors and the query points.</p>
</dd>
</dl>
<dl>
<dt>Shape:</dt><dd><ul>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coords_support_points</span></code>: <span class="math notranslate nohighlight">\((N, 3)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coords_query_points</span></code>: <span class="math notranslate nohighlight">\((N', 3)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">batch_indices_support_points</span></code>: <span class="math notranslate nohighlight">\((N)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">batch_indices_query_points</span></code>: <span class="math notranslate nohighlight">\((N')\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">point_cloud_sizes_support_points</span></code>: <span class="math notranslate nohighlight">\((B)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">point_cloud_sizes_query_points</span></code>: <span class="math notranslate nohighlight">\((B)\)</span></p></li>
<li><p>Output: Tuple of two tensors, both with shape <span class="math notranslate nohighlight">\((N', k)\)</span> if <code class="xref py py-attr docutils literal notranslate"><span class="pre">k</span></code> <span class="math notranslate nohighlight">\(\leq n_{max}\)</span>, otherwise <span class="math notranslate nohighlight">\((N', n_{max})\)</span>.</p>
<div class="line-block">
<div class="line">where</div>
<div class="line"><br/></div>
<div class="line"><span class="math notranslate nohighlight">\(B = \text{ batch size}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(N = \text{ number of support points}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(N' = \text{ number of query points}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(n_{max} = \text{ maximum number of neighbors a query point has}\)</span></div>
</div>
</li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="forest3d.operations.knn_search_pytorch3d">
<span class="sig-prename descclassname"><span class="pre">forest3d.operations.</span></span><span class="sig-name descname"><span class="pre">knn_search_pytorch3d</span></span><span class="sig-paren">(</span>
<dl>
<dd><em class="sig-param"><span class="n"><span class="pre">coords_support_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">coords_query_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">batch_indices_query_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">point_cloud_sizes_support_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">point_cloud_sizes_query_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">return_sorted</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>,</dd>
</dl>
<span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/forest3d/operations/_knn_search.html#knn_search_pytorch3d"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#forest3d.operations.knn_search_pytorch3d" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#forest3d.operations.knn_search_pytorch3d'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></dt>
<dd><p>Computes the indices of <code class="docutils literal notranslate"><span class="pre">k</span></code> nearest neighbors. This implementation is based on
<a class="reference external" href="https://pytorch3d.readthedocs.io/en/latest/modules/ops.html#pytorch3d.ops.knn_points" rel="nofollow noopener">PyTorch3D’s knn_points<svg fill="currentColor" height="1em" stroke="none" viewbox="0 96 960 960" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M188 868q-11-11-11-28t11-28l436-436H400q-17 0-28.5-11.5T360 336q0-17 11.5-28.5T400 296h320q17 0 28.5 11.5T760 336v320q0 17-11.5 28.5T720 696q-17 0-28.5-11.5T680 656V432L244 868q-11 11-28 11t-28-11Z"></path></svg></a>
function.</p>
<p>The GPU-based KNN search implementation from PyTorch3D launches one CUDA thread per query point and each thread then
loops through all the support points to find the k-nearest neighbors. It is similar to the torch-cluster
implementation but it requires input batches of regular shape. Therefore, the variable size point cloud batches are
packed into regular shaped batches before passing them to PyTorch3D.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coords_support_points</strong> – Coordinates of the support points to be searched for neighbors.</p></li>
<li><p><strong>coords_query_points</strong> – Coordinates of the query points.</p></li>
<li><p><strong>batch_indices_query_points</strong> – Indices indicating to which point cloud in the batch each query point belongs.</p></li>
<li><p><strong>point_cloud_sizes_support_points</strong> – Number of points in each point cloud in the batch of support points.</p></li>
<li><p><strong>point_cloud_sizes_query_points</strong> – Number of points in each point cloud in the batch of query points.</p></li>
<li><p><strong>k</strong> – The number of nearest neighbors to search.</p></li>
<li><p><strong>return_sorted</strong> – Whether the returned neighbors should be sorted by their distance to the query point. Defaults to
<code class="docutils literal notranslate"><span class="pre">True</span></code>. Setting it to <code class="docutils literal notranslate"><span class="pre">False</span></code> can improve performance for some implementations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of two tensors. The first tensor contains the indices of the neighbors of each query point. The
second tensor contains the distances between the neighbors and the query points.</p>
</dd>
</dl>
<dl>
<dt>Shape:</dt><dd><ul>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coords_support_points</span></code>: <span class="math notranslate nohighlight">\((N, 3)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coords_query_points</span></code>: <span class="math notranslate nohighlight">\((N', 3)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">batch_indices_query_points</span></code>: <span class="math notranslate nohighlight">\((N')\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">point_cloud_sizes_support_points</span></code>: <span class="math notranslate nohighlight">\((B)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">point_cloud_sizes_query_points</span></code>: <span class="math notranslate nohighlight">\((B)\)</span></p></li>
<li><p>Output: Tuple of two tensors, both with shape <span class="math notranslate nohighlight">\((N', k)\)</span> if <code class="xref py py-attr docutils literal notranslate"><span class="pre">k</span></code> <span class="math notranslate nohighlight">\(\leq n_{max}\)</span>, otherwise <span class="math notranslate nohighlight">\((N', n_{max})\)</span>.</p>
<div class="line-block">
<div class="line">where</div>
<div class="line"><br/></div>
<div class="line"><span class="math notranslate nohighlight">\(B = \text{ batch size}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(N = \text{ number of support points}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(N' = \text{ number of query points}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(n_{max} = \text{ maximum number of neighbors a query point has}\)</span></div>
</div>
</li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="forest3d.operations.knn_search_torch_cluster">
<span class="sig-prename descclassname"><span class="pre">forest3d.operations.</span></span><span class="sig-name descname"><span class="pre">knn_search_torch_cluster</span></span><span class="sig-paren">(</span>
<dl>
<dd><em class="sig-param"><span class="n"><span class="pre">coords_support_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">coords_query_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">batch_indices_support_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">batch_indices_query_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">point_cloud_sizes_support_points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>,</dd>
</dl>
<span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/forest3d/operations/_knn_search.html#knn_search_torch_cluster"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#forest3d.operations.knn_search_torch_cluster" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#forest3d.operations.knn_search_torch_cluster'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></dt>
<dd><p>Computes the indices of <code class="docutils literal notranslate"><span class="pre">k</span></code> nearest neighbors. This implementation is based on the
<a class="reference external" href="https://github.com/rusty1s/pytorch_cluster" rel="nofollow noopener">knn method from torch-cluster<svg fill="currentColor" height="1em" stroke="none" viewbox="0 96 960 960" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M188 868q-11-11-11-28t11-28l436-436H400q-17 0-28.5-11.5T360 336q0-17 11.5-28.5T400 296h320q17 0 28.5 11.5T760 336v320q0 17-11.5 28.5T720 696q-17 0-28.5-11.5T680 656V432L244 868q-11 11-28 11t-28-11Z"></path></svg></a>.</p>
<p>The GPU-based KNN search implementation from torch-cluster launches one CUDA thread per query point and each thread
then loops through all the support points to find the k-nearest neighbors. It is similar to the PyTorch3D
implementation but can handle variable size point clouds directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coords_support_points</strong> – Coordinates of the support points to be searched for neighbors.</p></li>
<li><p><strong>coords_query_points</strong> – Coordinates of the query points.</p></li>
<li><p><strong>batch_indices_support_points</strong> – Indices indicating to which point cloud in the batch each support point belongs.</p></li>
<li><p><strong>batch_indices_query_points</strong> – Indices indicating to which point cloud in the batch each query point belongs.</p></li>
<li><p><strong>point_cloud_sizes_support_points</strong> – Number of points in each point cloud in the batch of support points.</p></li>
<li><p><strong>k</strong> – The number of nearest neighbors to search.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of two tensors. The first tensor contains the indices of the neighbors of each query point. The
second tensor contains the distances between the neighbors and the query points.</p>
</dd>
</dl>
<dl>
<dt>Shape:</dt><dd><ul>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coords_support_points</span></code>: <span class="math notranslate nohighlight">\((N, 3)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">coords_query_points</span></code>: <span class="math notranslate nohighlight">\((N', 3)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">batch_indices_support_points</span></code>: <span class="math notranslate nohighlight">\((N)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">batch_indices_query_points</span></code>: <span class="math notranslate nohighlight">\((N')\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">point_cloud_sizes_support_points</span></code>: <span class="math notranslate nohighlight">\((B)\)</span></p></li>
<li><p>Output: Tuple of two tensors, both with shape <span class="math notranslate nohighlight">\((N', k)\)</span> if <code class="xref py py-attr docutils literal notranslate"><span class="pre">k</span></code> <span class="math notranslate nohighlight">\(\leq n_{max}\)</span>, otherwise <span class="math notranslate nohighlight">\((N', n_{max})\)</span>.</p>
<div class="line-block">
<div class="line">where</div>
<div class="line"><br/></div>
<div class="line"><span class="math notranslate nohighlight">\(B = \text{ batch size}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(N = \text{ number of support points}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(N' = \text{ number of query points}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(n_{max} = \text{ maximum number of neighbors a query point has}\)</span></div>
</div>
</li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="forest3d.operations.pack_batch">
<span class="sig-prename descclassname"><span class="pre">forest3d.operations.</span></span><span class="sig-name descname"><span class="pre">pack_batch</span></span><span class="sig-paren">(</span>
<dl>
<dd><em class="sig-param"><span class="n"><span class="pre">input_batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">point_cloud_sizes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">fill_value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">inf</span></span></em>,</dd>
</dl>
<span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/forest3d/operations/_pack_batch.html#pack_batch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#forest3d.operations.pack_batch" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#forest3d.operations.pack_batch'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></dt>
<dd><p>Packs a batch containing point clouds of varying size into a regular batch structure by padding all point clouds to
the same size.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_batch</strong> – Batch to be packed.</p></li>
<li><p><strong>point_cloud_sizes</strong> – Number of points in each point cloud in the batch.</p></li>
<li><p><strong>fill_value</strong> – Value to be used to pad point clouds that contain less points than the largest point cloud in the
batch. Defaults to <code class="docutils literal notranslate"><span class="pre">torch.inf</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of two tensors. The first tensor is the packed batch. Point clouds containing less than <span class="math notranslate nohighlight">\(N_{max}\)</span>
points are padded with <code class="xref py py-attr docutils literal notranslate"><span class="pre">fill_value</span></code>. The second tensor is a boolean mask, which is <code class="docutils literal notranslate"><span class="pre">True</span></code> in all positions
where the packed batch contains valid points and <code class="docutils literal notranslate"><span class="pre">False</span></code> in all positions filled with <code class="xref py py-attr docutils literal notranslate"><span class="pre">fill_value</span></code>.</p>
</dd>
</dl>
<dl>
<dt>Shape:</dt><dd><ul>
<li><div class="line-block">
<div class="line"><code class="xref py py-attr docutils literal notranslate"><span class="pre">input_batch</span></code>: <span class="math notranslate nohighlight">\((N_1 + ... + N_B, D)\)</span></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><code class="xref py py-attr docutils literal notranslate"><span class="pre">point_cloud_sizes</span></code>: <span class="math notranslate nohighlight">\((B)\)</span></div>
</div>
</li>
<li><div class="line-block">
<div class="line">Output: Tuple of two tensors with shape <span class="math notranslate nohighlight">\((B, N_{max}, D)\)</span> and <span class="math notranslate nohighlight">\((B, N_{max})\)</span>.</div>
<div class="line"><br/></div>
<div class="line">where</div>
<div class="line"><br/></div>
<div class="line"><span class="math notranslate nohighlight">\(B = \text{ batch size}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(D = \text{ number of feature channels}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(N_i = \text{ number of points in the i-th point cloud}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(N_{max} = \text{ number of points in the largest point cloud in the batch}\)</span></div>
</div>
</li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="forest3d.operations.ravel_index">
<span class="sig-prename descclassname"><span class="pre">forest3d.operations.</span></span><span class="sig-name descname"><span class="pre">ravel_index</span></span><span class="sig-paren">(</span>
<dl>
<dd><em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">input_tensor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>,</dd>
</dl>
<span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Tensor</span></span></span><a class="reference internal" href="_modules/forest3d/operations/_ravel_index.html#ravel_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#forest3d.operations.ravel_index" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#forest3d.operations.ravel_index'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></dt>
<dd><p>Converts index argument of a multi-dimensional
<a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.gather.html#torch-gather" rel="nofollow noopener">torch.gather()<svg fill="currentColor" height="1em" stroke="none" viewbox="0 96 960 960" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M188 868q-11-11-11-28t11-28l436-436H400q-17 0-28.5-11.5T360 336q0-17 11.5-28.5T400 296h320q17 0 28.5 11.5T760 336v320q0 17-11.5 28.5T720 696q-17 0-28.5-11.5T680 656V432L244 868q-11 11-28 11t-28-11Z"></path></svg></a> or
<a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.scatter_add.html" rel="nofollow noopener">torch.scatter_add()<svg fill="currentColor" height="1em" stroke="none" viewbox="0 96 960 960" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M188 868q-11-11-11-28t11-28l436-436H400q-17 0-28.5-11.5T360 336q0-17 11.5-28.5T400 296h320q17 0 28.5 11.5T760 336v320q0 17-11.5 28.5T720 696q-17 0-28.5-11.5T680 656V432L244 868q-11 11-28 11t-28-11Z"></path></svg></a> operation to an index
that can be used to apply the operation on the flattened input tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>index</strong> – Multi-dimensional index.</p></li>
<li><p><strong>input_tensor</strong> – Input tensor of the <code class="docutils literal notranslate"><span class="pre">torch.gather()</span></code> or <code class="docutils literal notranslate"><span class="pre">torch.scatter_add()</span></code> operation.</p></li>
<li><p><strong>dim</strong> – Dimension in which the <code class="docutils literal notranslate"><span class="pre">torch.gather()</span></code> or <code class="docutils literal notranslate"><span class="pre">torch.scatter_add()</span></code> operation is to be applied.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Index for applying <code class="docutils literal notranslate"><span class="pre">torch.gather()</span></code> or <code class="docutils literal notranslate"><span class="pre">torch.scatter_add()</span></code> on the flattened input tensor.</p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="forest3d.operations.ravel_multi_index">
<span class="sig-prename descclassname"><span class="pre">forest3d.operations.</span></span><span class="sig-name descname"><span class="pre">ravel_multi_index</span></span><span class="sig-paren">(</span>
<dl>
<dd><em class="sig-param"><span class="n"><span class="pre">multi_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">dims</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Size</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tensor</span></span></em>,</dd>
</dl>
<span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Tensor</span></span></span><a class="reference internal" href="_modules/forest3d/operations/_ravel_index.html#ravel_multi_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#forest3d.operations.ravel_multi_index" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#forest3d.operations.ravel_multi_index'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></dt>
<dd><p>PyTorch implementation of numpy.ravel_multi_index. This operation  is inverse to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">pointtorch.operations.torch.unravel_flat_index()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>multi_index</strong> – Tensor containing the indices for each dimension.</p></li>
<li><p><strong>dims</strong> – The shape of the tensor into which the indices from <code class="docutils literal notranslate"><span class="pre">multi_index</span></code> apply.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Indices for the flattened version of the tensor, referring to the same elements as referenced by
<code class="xref py py-attr docutils literal notranslate"><span class="pre">multi_index</span></code> for the non-flattened version of the tensor.</p>
</dd>
</dl>
<dl>
<dt>Shape:</dt><dd><ul>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">multi_index</span></code>: <span class="math notranslate nohighlight">\((N, d_1, ..., d_D)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">dims</span></code>: <span class="math notranslate nohighlight">\((D)\)</span></p></li>
<li><p>Output: <span class="math notranslate nohighlight">\((N \cdot d_1 \cdot ... \cdot d_D)\)</span></p>
<div class="line-block">
<div class="line">where</div>
<div class="line"><br/></div>
<div class="line"><span class="math notranslate nohighlight">\(N = \text{ number of items}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(D = \text{ number of index dimensions}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(d_i = \text{ number of elements along dimension } i\)</span></div>
</div>
</li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="forest3d.operations.unravel_flat_index">
<span class="sig-prename descclassname"><span class="pre">forest3d.operations.</span></span><span class="sig-name descname"><span class="pre">unravel_flat_index</span></span><span class="sig-paren">(</span>
<dl>
<dd><em class="sig-param"><span class="n"><span class="pre">flat_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">dims</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Size</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tensor</span></span></em>,</dd>
</dl>
<span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Tensor</span></span></span><a class="reference internal" href="_modules/forest3d/operations/_ravel_index.html#unravel_flat_index"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#forest3d.operations.unravel_flat_index" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#forest3d.operations.unravel_flat_index'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></dt>
<dd><p>Converts an index for a 1-dimensional tensor into an index for an equivalent multi-dimensional tensor. This
operation is inverse to <code class="xref py py-meth docutils literal notranslate"><span class="pre">pointtorch.operations.torch.ravel_multi_index()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>flat_index</strong> – Tensor containing the indices for the flat array.</p></li>
<li><p><strong>dims</strong> – The shape of the tensor into which the returned indices should apply.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Indices for the multi-dimensional version of the tensor, referring to the same elements as referenced by
<code class="xref py py-attr docutils literal notranslate"><span class="pre">flat_index</span></code> for the flattened version of the tensor.</p>
</dd>
</dl>
<dl>
<dt>Shape:</dt><dd><ul>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">flat_index</span></code>: <span class="math notranslate nohighlight">\((N \cdot d_1 \cdot ... \cdot d_D)\)</span></p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">dims</span></code>: <span class="math notranslate nohighlight">\((D)\)</span></p></li>
<li><p>Output: <span class="math notranslate nohighlight">\((N, d_1, ..., d_D)\)</span></p>
<div class="line-block">
<div class="line">where</div>
<div class="line"><br/></div>
<div class="line"><span class="math notranslate nohighlight">\(N = \text{ number of items}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(D = \text{ number of index dimensions}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(d_i = \text{ number of elements along dimension } i\)</span></div>
</div>
</li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="forest3d.operations.voxel_downsampling">
<span class="sig-prename descclassname"><span class="pre">forest3d.operations.</span></span><span class="sig-name descname"><span class="pre">voxel_downsampling</span></span><span class="sig-paren">(</span>
<dl>
<dd><em class="sig-param"><span class="n"><span class="pre">points</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">voxel_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">point_aggregation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'nearest_neighbor'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'random'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'random'</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">preserve_order</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>,</dd>
<dd><em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>,</dd>
</dl>
<span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/forest3d/operations/_voxel_downsampling.html#voxel_downsampling"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#forest3d.operations.voxel_downsampling" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#forest3d.operations.voxel_downsampling'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></dt>
<dd><p>Voxel-based downsampling of a point cloud.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>points</strong> – The point cloud to downsample.</p></li>
<li><p><strong>voxel_size</strong> – The size of the voxels used for downsampling. If <code class="xref py py-attr docutils literal notranslate"><span class="pre">voxel_size</span></code> is set to zero or less, no
downsampling is applied.</p></li>
<li><p><strong>point_aggregation</strong> – Method to be used to aggregate the points within the same voxel. Defaults to
<code class="docutils literal notranslate"><span class="pre">nearest_neighbor</span></code>. <code class="docutils literal notranslate"><span class="pre">"nearest_neighbor"</span></code>: The point closest to the voxel center is selected. <code class="docutils literal notranslate"><span class="pre">"random"</span></code>:
One point is randomly sampled from the voxel.</p></li>
<li><p><strong>preserve_order</strong> – If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the point order is preserved during downsampling. This means that for any two
points included in the downsampled point cloud, the point that is first in the original point cloud is
also first in the downsampled point cloud. Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><strong>start</strong> – Coordinates of a point at which the voxel grid is to be aligned, i.e., the grid is placed so that
<code class="xref py py-attr docutils literal notranslate"><span class="pre">start</span></code> is at a corner point of a voxel. Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, which means that the grid is aligned at
the coordinate origin.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of two arrays. The first contains the points remaining after downsampling. The second contains the indices of the points remaining after downsampling within the original point cloud.^</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If <code class="docutils literal notranslate"><span class="pre">start</span></code> is not <code class="docutils literal notranslate"><span class="pre">None</span></code> and has an invalid shape.</p>
</dd>
</dl>
<dl>
<dt>Shape:</dt><dd><ul>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">points</span></code>: <span class="math notranslate nohighlight">\((N, 3 + D)\)</span>.</p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">start</span></code>: <span class="math notranslate nohighlight">\((3)\)</span></p></li>
<li><p>Output: Tuple of two arrays. The first has shape <span class="math notranslate nohighlight">\((N', 3 + D)\)</span> and the second <span class="math notranslate nohighlight">\((N')\)</span>.</p>
<div class="line-block">
<div class="line">where</div>
<div class="line"><br/></div>
<div class="line"><span class="math notranslate nohighlight">\(N = \text{ number of points before downsampling}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(N' = \text{ number of points after downsampling}\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(D = \text{ number of feature channels excluding coordinate channels }\)</span></div>
</div>
</li>
</ul>
</dd>
</dl>
</dd></dl>
</section>
</div><div class="flex justify-between items-center pt-6 mt-12 border-t border-border gap-4">
<div class="mr-auto">
<a class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors border border-input hover:bg-accent hover:text-accent-foreground py-2 px-4" href="forest3d.instance_segmentation.html">
<svg class="mr-2 h-4 w-4" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<polyline points="15 18 9 12 15 6"></polyline>
</svg>
        forest3d.instance_segmentation
      </a>
</div>
<div class="ml-auto">
<a class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors border border-input hover:bg-accent hover:text-accent-foreground py-2 px-4" href="forest3d.visualization.html">
        forest3d.visualization
        <svg class="ml-2 h-4 w-4" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<polyline points="9 18 15 12 9 6"></polyline>
</svg>
</a>
</div>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(100vh-5rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#forest3d.operations.knn_search'" class="reference internal" href="#forest3d.operations.knn_search"><code class="docutils literal notranslate"><span class="pre">knn_search()</span></code></a></li>
<li><a :data-current="activeSection === '#forest3d.operations.knn_search_pytorch3d'" class="reference internal" href="#forest3d.operations.knn_search_pytorch3d"><code class="docutils literal notranslate"><span class="pre">knn_search_pytorch3d()</span></code></a></li>
<li><a :data-current="activeSection === '#forest3d.operations.knn_search_torch_cluster'" class="reference internal" href="#forest3d.operations.knn_search_torch_cluster"><code class="docutils literal notranslate"><span class="pre">knn_search_torch_cluster()</span></code></a></li>
<li><a :data-current="activeSection === '#forest3d.operations.pack_batch'" class="reference internal" href="#forest3d.operations.pack_batch"><code class="docutils literal notranslate"><span class="pre">pack_batch()</span></code></a></li>
<li><a :data-current="activeSection === '#forest3d.operations.ravel_index'" class="reference internal" href="#forest3d.operations.ravel_index"><code class="docutils literal notranslate"><span class="pre">ravel_index()</span></code></a></li>
<li><a :data-current="activeSection === '#forest3d.operations.ravel_multi_index'" class="reference internal" href="#forest3d.operations.ravel_multi_index"><code class="docutils literal notranslate"><span class="pre">ravel_multi_index()</span></code></a></li>
<li><a :data-current="activeSection === '#forest3d.operations.unravel_flat_index'" class="reference internal" href="#forest3d.operations.unravel_flat_index"><code class="docutils literal notranslate"><span class="pre">unravel_flat_index()</span></code></a></li>
<li><a :data-current="activeSection === '#forest3d.operations.voxel_downsampling'" class="reference internal" href="#forest3d.operations.voxel_downsampling"><code class="docutils literal notranslate"><span class="pre">voxel_downsampling()</span></code></a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2024, Josafat-Mattias Burmeister. Last updated: Apr 30, 2024. Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 7.2.6</a></p>
</div>
</div>
</footer>
</div>
<script src="_static/documentation_options.js?v=a12e3537"></script>
<script src="_static/doctools.js?v=888ff710"></script>
<script src="_static/sphinx_highlight.js?v=dc90522c"></script>
<script defer="defer" src="_static/theme.js?v=8dc3ddfe"></script>
<script src="_static/design-tabs.js?v=36754332"></script>
<script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>